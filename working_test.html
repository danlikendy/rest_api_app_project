<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>API Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        button { padding: 10px; margin: 5px; }
        .result { background: #f5f5f5; padding: 10px; margin: 10px 0; white-space: pre-wrap; font-family: monospace; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e8; color: #2e7d32; }
    </style>
</head>
<body>
    <h1>Organizations API Test</h1>
    
    <div class="section">
        <h3>1. Все организации</h3>
        <button onclick="test1()">Тест</button>
        <div id="result1" class="result">Нажмите кнопку</div>
    </div>

    <div class="section">
        <h3>2. Поиск по названию</h3>
        <input type="text" id="searchText" value="Рога">
        <button onclick="test2()">Поиск</button>
        <div id="result2" class="result">Нажмите кнопку</div>
    </div>

    <div class="section">
        <h3>3. Поиск по виду деятельности</h3>
        <button onclick="test3()">Еда (ID=1)</button>
        <div id="result3" class="result">Нажмите кнопку</div>
    </div>

    <div class="section">
        <h3>4. Поиск в радиусе</h3>
        <button onclick="test4()">Радиус 5км от Москвы</button>
        <div id="result4" class="result">Нажмите кнопку</div>
    </div>

    <script>
        const API_URL = 'http://localhost:8000';
        const API_KEY = 'your-secret-api-key-here';

        function showResult(elementId, data, isError = false) {
            const element = document.getElementById(elementId);
            element.textContent = JSON.stringify(data, null, 2);
            element.className = 'result ' + (isError ? 'error' : 'success');
        }

        async function test1() {
            try {
                const response = await fetch(`${API_URL}/organizations`, {
                    headers: { 'X-API-Key': API_KEY }
                });
                const data = await response.json();
                showResult('result1', data);
            } catch (error) {
                showResult('result1', { error: error.message }, true);
            }
        }

        async function test2() {
            try {
                const searchText = document.getElementById('searchText').value;
                const response = await fetch(`${API_URL}/organizations/search/name?name=${encodeURIComponent(searchText)}`, {
                    headers: { 'X-API-Key': API_KEY }
                });
                const data = await response.json();
                showResult('result2', data);
            } catch (error) {
                showResult('result2', { error: error.message }, true);
            }
        }

        async function test3() {
            try {
                const response = await fetch(`${API_URL}/organizations/activity/1`, {
                    headers: { 'X-API-Key': API_KEY }
                });
                const data = await response.json();
                showResult('result3', data);
            } catch (error) {
                showResult('result3', { error: error.message }, true);
            }
        }

        async function test4() {
            try {
                const response = await fetch(`${API_URL}/organizations/search/radius?latitude=55.7558&longitude=37.6176&radius_km=5`, {
                    headers: { 'X-API-Key': API_KEY }
                });
                const data = await response.json();
                showResult('result4', data);
            } catch (error) {
                showResult('result4', { error: error.message }, true);
            }
        }

        // Автоматический тест при загрузке
        window.onload = function() {
            setTimeout(test1, 1000);
        };
    </script>
</body>
</html>
